<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MSD Replay Viewer</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <!-- Ticket: 0056e_threejs_core_visualization -->
    <!-- Three.js core visualization with playback controls -->

    <div id="viewport-container">
        <canvas id="viewport"></canvas>

        <!-- Loading indicator -->
        <div id="loading-indicator" class="loading">
            <div class="spinner"></div>
            <div>Loading simulation...</div>
        </div>

        <!-- Ticket: 0056f_threejs_overlays -->
        <!-- Energy Chart Overlay -->
        <div id="energy-chart-container" class="overlay-panel energy-chart hidden">
            <div class="panel-header">
                Energy vs Frame
                <button id="btn-minimize-energy" class="btn-minimize">−</button>
            </div>
            <canvas id="energy-chart"></canvas>
        </div>

        <!-- Inspector Panel -->
        <div id="inspector-panel" class="overlay-panel inspector hidden">
            <div class="inspector-content">
                <em>Click a body to inspect</em>
            </div>
        </div>

        <!-- Solver Diagnostics Bar -->
        <div id="solver-status" class="solver-diagnostics hidden">
            <em>No solver data</em>
        </div>
    </div>

    <div id="controls-panel">
        <!-- Simulation Selection -->
        <div class="control-group">
            <label for="sim-select">Simulation:</label>
            <select id="sim-select">
                <option value="">Loading...</option>
            </select>
        </div>

        <!-- Playback Controls -->
        <div class="control-group playback-controls">
            <button id="btn-step-back" title="Step Back (←)">⏮</button>
            <button id="btn-play-pause" title="Play/Pause (Space)">▶</button>
            <button id="btn-step-forward" title="Step Forward (→)">⏭</button>
        </div>

        <!-- Timeline Scrubber -->
        <div class="control-group timeline">
            <input type="range" id="timeline-slider" min="0" max="100" value="0">
            <div class="timeline-info">
                <span id="frame-display">Frame 0 / 0</span>
                <span id="time-display">Time: 0.000s</span>
            </div>
        </div>

        <!-- Speed Control -->
        <div class="control-group">
            <label>Speed:</label>
            <div class="speed-controls">
                <button class="speed-btn" data-speed="0.25">0.25x</button>
                <button class="speed-btn" data-speed="0.5">0.5x</button>
                <button class="speed-btn active" data-speed="1">1x</button>
                <button class="speed-btn" data-speed="2">2x</button>
                <button class="speed-btn" data-speed="4">4x</button>
            </div>
        </div>

        <!-- Camera Controls -->
        <div class="control-group">
            <button id="btn-reset-camera">Reset Camera</button>
        </div>

        <!-- Ticket: 0056f_threejs_overlays -->
        <!-- Overlay Toggles -->
        <div class="control-group overlay-toggles">
            <label>Overlays:</label>
            <div class="toggle-grid">
                <label class="toggle-label">
                    <input type="checkbox" id="toggle-contact-points">
                    Contact Points
                </label>
                <label class="toggle-label">
                    <input type="checkbox" id="toggle-contact-normals">
                    Contact Normals
                </label>
                <label class="toggle-label">
                    <input type="checkbox" id="toggle-constraint-forces">
                    Constraint Forces
                </label>
                <label class="toggle-label">
                    <input type="checkbox" id="toggle-gravity">
                    Gravity Arrows
                </label>
                <label class="toggle-label">
                    <input type="checkbox" id="toggle-energy" checked>
                    Energy Graph
                </label>
                <label class="toggle-label">
                    <input type="checkbox" id="toggle-inspector">
                    Body Inspector
                </label>
                <label class="toggle-label">
                    <input type="checkbox" id="toggle-solver">
                    Solver Diagnostics
                </label>
            </div>
        </div>
    </div>

    <!-- Three.js from CDN -->
    <script type="importmap">
    {
        "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
            "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/"
        }
    }
    </script>

    <!-- Ticket: 0056f_threejs_overlays -->
    <!-- Chart.js for energy graph -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.0.1/dist/chartjs-plugin-annotation.min.js"></script>

    <!-- Application modules -->
    <script type="module" src="/static/js/app.js"></script>
</body>
</html>
