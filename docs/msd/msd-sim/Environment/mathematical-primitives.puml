@startuml
' =============================================================================
' Feature: Mathematical Primitives
' Description: Core value types for 3D coordinates, angles, and kinematic state
' Date: 2026-01-01
' =============================================================================

!theme cyborg

' -----------------------------------------------------------------------------
' Styling - documenting existing components (no new/modified highlighting)
' -----------------------------------------------------------------------------
skinparam class {
    BackgroundColor White
    BorderColor Black
}

skinparam note {
    BackgroundColor #2d2d2d
    BorderColor #666666
}

' -----------------------------------------------------------------------------
' Package/Namespace Organization
' -----------------------------------------------------------------------------
package "msd_sim" {

    class Coordinate {
        ' Inherits from Eigen::Vector3d
        ..
        ' Construction
        +Coordinate()
        +Coordinate(x: double, y: double, z: double)
        +Coordinate(vec: Eigen::Vector3d)
        ..
        ' Inherited from Eigen::Vector3d
        +x(): double
        +y(): double
        +z(): double
        +norm(): double
        +normalized(): Coordinate
        +dot(other: Coordinate): double
        +cross(other: Coordinate): Coordinate
        ..
        ' Operators
        +operator+(other): Coordinate
        +operator-(other): Coordinate
        +operator*(scalar): Coordinate
    }

    class AngularCoordinate {
        ' Inherits from Eigen::Vector3d
        ..
        +AngularCoordinate()
        +AngularCoordinate(pitch, roll, yaw: double)
        +pitch(): double
        +roll(): double
        +yaw(): double
        +pitchDeg(): double
        +rollDeg(): double
        +yawDeg(): double
        +normalized(): AngularCoordinate
        +normalize(): void
    }

    class AngularRate {
        ' Inherits from Eigen::Vector3d
        ..
        +AngularRate()
        +AngularRate(pitchRate, rollRate, yawRate: double)
        +pitch(): double& / double
        +roll(): double& / double
        +yaw(): double& / double
    }

    class InertialState {
        ' Linear components
        +position: Coordinate
        +velocity: Coordinate
        +acceleration: Coordinate
        ..
        ' Angular components
        +orientation: AngularCoordinate
        +angularVelocity: AngularRate
        +angularAcceleration: AngularRate
        ..
        +InertialState() = default
    }
}

package "Eigen" {
    class "Eigen::Vector3d" as EigenVector3d {
        +x(): double
        +y(): double
        +z(): double
    }
}

' -----------------------------------------------------------------------------
' Relationships
' -----------------------------------------------------------------------------

' Inheritance
Coordinate --|> EigenVector3d : inherits
AngularCoordinate --|> EigenVector3d : inherits
AngularRate --|> EigenVector3d : inherits

' Composition
InertialState *-- "3" Coordinate : linear state
InertialState *-- AngularCoordinate : orientation
InertialState *-- "2" AngularRate : angular rates

' -----------------------------------------------------------------------------
' Notes
' -----------------------------------------------------------------------------
note right of Coordinate
    Thread safety: Immutable after creation
    Value semantics: Safe to copy

    **Aerospace Convention:**
    X-axis: Forward (velocity)
    Y-axis: Right (starboard)
    Z-axis: Up (zenith)

    Supports std::format:
    "{:.2f}" → "(100.00, 200.00, 300.00)"
end note

note right of AngularCoordinate
    **Deferred Normalization:**
    Normalizes to (-π, π] only when
    |value| exceeds 100π threshold.

    Check occurs in ALL modifying operations.
    Accessors return raw values (fast).

    **Memory:** 24 bytes
    **Performance:** 0% accessor overhead

    See angular-coordinate.puml for details.
end note

note right of AngularRate
    **NO Normalization:**
    Angular rates like 720°/s are
    valid and should NOT be normalized.

    **Units:**
    - Velocity: rad/s
    - Acceleration: rad/s²

    See angular-coordinate.puml for details.
end note

note bottom of InertialState
    **Complete Kinematic State:**
    6 DOF with first and second
    derivatives.

    **Type Safety:**
    AngularCoordinate vs AngularRate
    prevents accidental misuse.

    Value semantics - safe to
    copy across threads.
end note

@enduml
