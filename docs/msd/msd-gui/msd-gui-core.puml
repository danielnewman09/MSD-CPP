@startuml msd-gui-core
' =============================================================================
' Feature: msd-gui - Core Architecture Overview
' Description: High-level component structure and relationships
' Date: 2026-01-05
' =============================================================================

' -----------------------------------------------------------------------------
' Styling
' -----------------------------------------------------------------------------
skinparam class {
    BackgroundColor White
    BorderColor Black
}

skinparam note {
    BackgroundColor #FFFFCC
    BorderColor #999999
}

' -----------------------------------------------------------------------------
' Core Components
' -----------------------------------------------------------------------------
package "msd_gui" {

    ' Application Layer
    class SDLApplication {
        +SDLApplication(dbPath: string)
        +runApp(): int
        +getStatus(): Status
    }

    enum Status {
        Starting
        Running
        Paused
        Error
        Exiting
    }

    ' GPU Management Layer
    class GPUManager {
        +GPUManager(window: SDL_Window&, basePath: string)
        +render(): void
        +getCamera(): Camera3D&
        +addInstance(...): void
        +removeInstance(index): void
    }

    struct InstanceData {
        +position[3]: float
        +color[3]: float
    }

    ' Camera System
    class Camera3D {
        +Camera3D(position: Coordinate, fov, aspect, near, far)
        +getViewMatrix(): Matrix4f
        +getProjectionMatrix(): Matrix4f
        +getMVPMatrix(model): Matrix4f
    }

    ' Input Management Layer
    class InputHandler {
        +addBinding(binding: InputBinding): void
        +handleSDLEvent(event: SDL_Event): void
        +update(deltaTime: milliseconds): void
        +processInput(): void
        +getInputState(): InputState&
    }

    class InputState {
        +updateKey(key: SDL_Keycode, pressed: bool): void
        +isKeyPressed(key: SDL_Keycode): bool
        +isKeyJustPressed(key: SDL_Keycode): bool
        +getKeyHoldDuration(key: SDL_Keycode): milliseconds
    }

    enum InputMode {
        Continuous
        TriggerOnce
        Interval
        PressAndHold
    }

    class CameraController {
        +CameraController(camera: Camera3D&, moveSpeed, rotSpeed)
        +updateFromInput(inputState: InputState, deltaTime): void
        +setMoveSpeed(speed: float): void
        +setRotationSpeed(speed: Angle): void
    }

    ' Utilities
    class SDLException {
        +SDLException(message: string)
    }
}

' External dependencies
package "msd_sim" {
    class Engine
    class ReferenceFrame
    class Coordinate
}

package "msd_assets" {
    class GeometryFactory {
        {static} +createPyramid(base, height): MeshRecord
    }
}

package "SDL3" {
    class SDL_Window
    class SDL_GPUDevice
}

' -----------------------------------------------------------------------------
' Relationships
' -----------------------------------------------------------------------------

' SDLApplication owns GPUManager, Engine, InputHandler, CameraController
SDLApplication *-- GPUManager : owns (unique_ptr)
SDLApplication *-- Engine : owns (value)
SDLApplication *-- InputHandler : owns (unique_ptr)
SDLApplication *-- CameraController : owns (unique_ptr)
SDLApplication o-- SDL_Window : manages

' GPUManager owns Camera3D and GPU resources
GPUManager *-- Camera3D : owns (value)
GPUManager *-- InstanceData : manages instances
GPUManager o-- SDL_GPUDevice : manages
GPUManager ..> GeometryFactory : uses for\nbase mesh

' Input management relationships
InputHandler *-- InputState : owns (value)
InputHandler ..> InputMode : uses
CameraController --> Camera3D : non-owning reference
CameraController ..> InputState : reads

' Camera3D uses ReferenceFrame
Camera3D *-- ReferenceFrame : owns (value)
Camera3D ..> Coordinate : uses

' Status enum
SDLApplication -- Status

@enduml
