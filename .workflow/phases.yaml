# Phase definitions for MSD-CPP ticket lifecycle
# Ticket: 0083_database_agent_orchestration
#
# Maps the full MSD-CPP ticket lifecycle to workflow-engine phase definitions.
# Agent types map to .claude/agents/*.md definitions.
# Conditions control which phases apply to a given ticket.
#
# Human gate phases have agent_type: null â€” the workflow engine creates a
# human_gates record and blocks downstream phases until approved via CLI.

phases:
  - name: "Math Design"
    agent_type: "math-designer"
    condition:
      field: "requires_math_design"
      value: true

  - name: "Math Design Review"
    agent_type: null  # human gate
    condition:
      field: "requires_math_design"
      value: true

  - name: "Design"
    agent_type: "cpp-architect"

  - name: "Design Review"
    agent_type: "design-reviewer"

  - name: "Integration Design"
    agent_type: "integration-designer"
    condition:
      field: "languages"
      has_multiple: true

  - name: "Integration Review"
    agent_type: "integration-reviewer"
    condition:
      field: "languages"
      has_multiple: true

  - name: "Python Design"
    agent_type: "python-architect"
    condition:
      field: "languages"
      contains: "Python"

  - name: "Python Design Review"
    agent_type: null  # human gate
    condition:
      field: "languages"
      contains: "Python"

  - name: "Frontend Design"
    agent_type: "frontend-architect"
    condition:
      field: "languages"
      contains: "Frontend"

  - name: "Frontend Design Review"
    agent_type: null  # human gate
    condition:
      field: "languages"
      contains: "Frontend"

  - name: "Prototype"
    agent_type: "cpp-prototyper"

  - name: "Prototype Review"
    agent_type: null  # human gate

  - name: "Implementation"
    agent_type: "cpp-implementer"

  - name: "Test Writing"
    agent_type: "cpp-test-writer"

  - name: "Quality Gate"
    agent_type: "code-quality-gate"

  - name: "Implementation Review"
    agent_type: "implementation-reviewer"

  - name: "Documentation"
    agent_type: "docs-updater"

  - name: "Tutorial"
    agent_type: "cpp-tutorial-generator"
    condition:
      field: "generate_tutorial"
      value: true

# Parallel phase groups: phases in the same group run concurrently.
# All phases in a group must complete before the next sequential phase.
# These override the sequential phases above for multi-language tickets.
parallel_groups:
  impl:
    after: "Integration Review"  # becomes available after this phase completes
    before: "Quality Gate"       # this phase waits for all group members
    phases:
      - name: "C++ Implementation"
        agent_type: "cpp-implementer"
        condition:
          field: "languages"
          contains: "C++"

      - name: "Python Implementation"
        agent_type: "python-implementer"
        condition:
          field: "languages"
          contains: "Python"

      - name: "Frontend Implementation"
        agent_type: "frontend-implementer"
        condition:
          field: "languages"
          contains: "Frontend"

  tests:
    after: "C++ Implementation"   # after impl group completes
    before: "Quality Gate"
    phases:
      - name: "C++ Test Writing"
        agent_type: "cpp-test-writer"
        condition:
          field: "languages"
          contains: "C++"

      - name: "Python Test Writing"
        agent_type: "python-test-writer"
        condition:
          field: "languages"
          contains: "Python"

# Metadata fields to extract from ticket markdown for condition evaluation
# and DB storage. The engine uses these to evaluate phase conditions.
ticket_metadata:
  - field: "requires_math_design"
    type: "boolean"
    default: false
    markdown_key: "Requires Math Design"

  - field: "generate_tutorial"
    type: "boolean"
    default: false
    markdown_key: "Generate Tutorial"

  - field: "languages"
    type: "list"
    default: ["C++"]
    markdown_key: "Languages"

  - field: "priority"
    type: "enum"
    values: ["Low", "Medium", "High", "Critical"]
    markdown_key: "Priority"

  - field: "complexity"
    type: "enum"
    values: ["Small", "Medium", "Large", "XL"]
    markdown_key: "Estimated Complexity"

  - field: "components"
    type: "list"
    markdown_key: "Target Component(s)"

  - field: "github_issue"
    type: "integer"
    markdown_key: "GitHub Issue"
